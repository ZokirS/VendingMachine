@{
    ViewData["Title"] = "Vending Machine";
}

<h2>Vending Machine</h2>

<div>
    <h3>Insert Coins</h3>
    <button id="coin1" onclick="insertCoin(1)" @if (Model.IsCoinBlocked(1))
    {
        <text>disabled</text>
    }>1 ruble</button>
    <button id="coin2" onclick="insertCoin(2)" @if (Model.IsCoinBlocked(2))
    {
        <text>disabled</text>
    }>2 rubles</button>
    <button id="coin5" onclick="insertCoin(5)" @if (Model.IsCoinBlocked(5))
    {
        <text>disabled</text>
    }>5 rubles</button>
    <button id="coin10" onclick="insertCoin(10)" @if (Model.IsCoinBlocked(10))
    {
        <text>disabled</text>
    }>10 rubles</button>
    <br />
    <p>Amount Inserted: <span id="amountInserted">@Model.AmountInserted</span> rubles</p>
</div>

<div>
    <h3>Select Beverage</h3>
    @foreach (var beverage in Model.Beverages)
    {
        <div>
            <img src="@beverage.ImageUrl" alt="@beverage.Name" width="100" height="100" />
            <p>@beverage.Name - @beverage.Price rubles</p>
            <button onclick="selectBeverage('@beverage.Id', @beverage.Price)" @if (!Model.CanSelectBeverage(beverage.Id))
            {
                <text>disabled</text>
            }>Buy</button>
        </div>
    }
</div>

<div>
    <h3>Change</h3>
    <p>Change: <span id="change">@Model.Change</span> rubles</p>
    <button onclick="getChange()" @if (Model.Change <= 0)
    {
        <text>disabled</text>
    }>Get Change</button>
</div>

<script>
    function insertCoin(coin) {
        // Make an AJAX request to the server to insert the coin
        $.ajax({
            type: "POST",
            url: "/VendingMachine/InsertCoin",
            data: { coin: coin },
            success: function (result) {
                // Update the amount inserted on the page
                $("#amountInserted").text(result.amountInserted);
            }
        });
    }

    function selectBeverage(beverageId, beveragePrice) {
        // Make an AJAX request to the server to select the beverage
        $.ajax({
            type: "POST",
            url: "/VendingMachine/SelectBeverage",
            data: { beverageId: beverageId },
            success: function (result) {
                if (result.success) {
                    // Update the remaining beverages and amount inserted on the page
                    $("#" + beverageId).prop("disabled", true);
                    $("#amountInserted").text(result.amountInserted);
                }
                else {
                    alert(result.message);
                }
            }
        });
    }

    function getChange() {
        // Make an AJAX request to the server to get the change
        $.ajax({
            type: "POST",
            url: "/VendingMachine/GetChange",
            success: function (result) {
                if (result.success) {
                    // Update the change on the page
                    $("#change").text(result.change);
                }
                else {
                    alert(result.message);
                }
            }
        });
    }
</script>
